---
- name: clone
  vars:
    ssh_key: |
      -----BEGIN RSA PRIVATE KEY-----
      MIIEpAIBAAKCAQEApMkam+mhwCdCQdqtu7U9p5VRFmkrbi9HaA3vagphMvyryWqx
      C9sY+an8jCNRUpelyjJ8f6b6/V5h4WcnlwpOvVGGns4HObnYj89GKoBF+QpT28mp
      CMi0kzHNSWMRZg/d9x3Af2cDIgJhgGKdKLhOb+SJ2iRzKA6ywmyNTrUB4tJhpgJ/
      PA1lGlYXkGad2KRAfg7mTcuQrqLJ4qi2XdgAHctISN9wUdbE1x5HFPyzukwKuBAE
      h7m6VVrJzskKNrBsuOVSZuQ6rv9TiqWXVpAXgrWvKztlf3SNAttmABb5d2uPOa2+
      reCWEzHbWOFgMQDQsXsS3rqC3fzw4VMKRQwXIQIDAQABAoIBADgZOpTPkcBf3R+c
      Ob8IcYfmvmc5wI5PTCjxbYsVI4f/GuCEEOfvW+5K324568qJU+ilDVtL1nCBPCNH
      QeQanzm2UnUnwK/3Q/GZZ9K6PpgM2wWc/o29/jOKJdARCPBNAIzLNShqQlfGpbjW
      WZhuPk27aO65r/Z4IoUr/WNJHe5Akv5FMfseAZ+zlAHA32QqNggOeit65Gio2cIu
      YDKI5Nr1iiSq3JMfEZvmc/5QedU9U7DIeNWwji8pGzFkF8xhu6Ey9hpGR2U7gEqR
      +dySnwi8+qaspof8rguGeSUZVmoTGmfYUEnz1ZpJVaQiABkaVXwADahhve8td1Tr
      7h1b+Q0CgYEA1vDp7OklWyvFiePYu4rlnmjVKNv6kbUULtOix9yKWbApY6ljpYhS
      yigiqV6jiVorC1ClcXPWpWsHosd+p6DRaa0MiqD2WJPSXndComGRsOrCeO7DrLWl
      UCRHl1OlcRHcuxSqVDH+CCqW+NC4JxUKc22OzI+kaKTruj3s9XkefIMCgYEAxEN6
      B7xANY9ceb1Xoev3Z7AWIhLPQ8GPZ3KSSmz1Zdp11MNouxRJBzDS4k64Qv2n44JP
      U+kbXSjvnCyITCjTevDIsKxHtO0wOLEwB5LCBzpJTEsjwGZcTP0AOv6dqwJwLPpm
      ysiTrLFBH5SdVsTMt8UJFxZ33sDWHZvSo0p21IsCgYB688rMk72jvpE8RJLpDRY2
      nH865UMbcHsAIl4ed+DIV0YF1ZLD0QySyYyyWAmye1reGR7anEnvzB7NFdM0roC8
      M5pV/qeMmdqf4RbD7o45psDiDqruM+ZBxs8RGG8uE+qxNawNh59qKnq8ECEXcijN
      SKGEELMajSSvH9dZwBQZYwKBgQCcBhiI9bsF2UZm8YMtEm3IXE/8Hn/vGX1re8WY
      rS4ZHqb10bL8po+3y7SafII3n3dMgleWGYbLdLOnsC9afEpDPhANg6gtyTHAn/vS
      yXS+UjPbFxEA718JRUhdnfSx8mpDF32IUBQ2AWQIOxkp1aH5pgYn+JCq4RpWx32Y
      mqYFKQKBgQCbEsvYlfeWJDi+CBH+zhfkfWIY9SiyuHEUQa4hNbaS/DkDMgqN58Cu
      8gXGSftEiTcLat0a0P6veacgPKuhAHe1K7h84+R0rE/cv1QTBpW38RQgabLs+exy
      jyF5R1NHI/LXsDBNaiR05srXdiSZumL0awX7riC4DzIk6ZZYRdbnbQ==
      -----END RSA PRIVATE KEY-----
  tasks:
  - ssh_agent:
      key: "$ssh_key"
  - git_clone:
      repo: git@github.com:vexor/vx-test-repo.git
      dest: "~/vexor/vx-test-repo"
      branch: test/pull-request
      sha: 8f53c077072674972e21c82a286acc07fada91f5
- name: init
  chdir: "~/vexor/vx-test-repo"
  environment:
    CI: '1'
    CI_JOB_ID: 1
    CI_JOB_NUMBER: 100
    CI_BUILD_ID: 12
    CI_BUILD_NUMBER: 101
    CI_PROJECT_NAME: vexor/vx-test-repo
    CI_BUILD_SHA: 8f53c077072674972e21c82a286acc07fada91f5
    CI_BRANCH: test/pull-request
    DISPLAY: ":99"
    CI_PARALLEL_JOBS: 3
    CI_PARALLEL_JOB_NUMBER: 0
    global: ''
    matrix: ''
    RAILS_ENV: test
    RACK_ENV: test
    GEM_HOME: "~/.rubygems"
    TRAVIS_PYTHON_VERSION: py_version
  tasks:
  - services:
    - rabbitmq-server
  - cache_fetch:
      url:
      - http://localhost:3001/test/pull-request/scala-2.10.3-rvm-2.0.0-gemfile-nodejs-0.10-rust-0.11.0-python-2.7.tgz
      - http://localhost:3001/master/scala-2.10.3-rvm-2.0.0-gemfile-nodejs-0.10-rust-0.11.0-python-2.7.tgz
  - cache_add:
      dir:
      - "~/.cache"
      - "~/.sbt"
      - "~/.ivy2"
      - "~/.rubygems"
      - node_modules
      - bower_components
      - "~/.pip-downloads"
- name: before_install
  tasks:
  - shell: echo before_install
- name: install
  environment:
    PATH: "${PATH}:${PWD}/node_modules/bin"
  tasks:
  - scala:
      action: install
      scala: 2.10.3
  - ruby:
      action: install
      ruby: 2.0.0
  - ruby: announce
  - vxvm: nodejs 0.10
  - shell: npm config set spin false
  - shell: node --version
  - shell: npm --version
  - vxvm: rust 0.11.0
  - shell: rustc --version
  - python:
      action: install
      python: '2.7'
  - python: virtualenv
  - python: announce
  - shell: echo install
- name: database
  tasks:
  - ruby: rails:database
- name: before_script
  tasks:
  - shell: echo before_script
- name: script
  tasks:
  - shell: RAILS_ENV=test ls -1 && echo DONE!
- name: after_success
  tasks:
  - shell: echo after success
- name: teardown
  tasks:
  - cache_push:
      url: http://localhost:3001/test/pull-request/scala-2.10.3-rvm-2.0.0-gemfile-nodejs-0.10-rust-0.11.0-python-2.7.tgz
